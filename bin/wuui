#!/usr/bin/env node

process.env.NODE_PATH = __dirname + '/../node_modules/'
const { resolve } = require('path')
const res = command => resolve(__dirname, '../commands/', command)
const MModule = require('../commands/module')
const Page = require('../commands/page')
const program = require('commander')

program
  .version(require('../package').version )

program
  .usage('<command>')

// Command: wuui init
program
  .command('init')
  .description('生产一个新的')
  .alias('i')
  .action(() => {
    require(res('init'))
  })

// Command: wuui lsit
program
  .command('list')
  .description('查询所有项目模版')
  .alias('l')
  .action(() => {
    require(res('list'))
  })

// Command: wuui module [moduleName]
program
  .command('module [moduleName]')
  .alias('m')
  .description('创建新的模块')
  .option('--name [moduleName]', '模块名称')
  .action(function(moduleName, option) {
    createModule(moduleName, option)
  }).on('--help', function() {
    console.log('  Examples:')
    console.log('')
    console.log('    $ wuui module name')
    console.log('    $ wuui m name')
    console.log()
  })

// 创建模块
function createModule (moduleName, option) {
  return new Promise(function (resolve, reject) {
    let mmodule = new MModule({
      moduleName: moduleName || option.name,
      moduleDescription: option.description,
    })
    mmodule.create(function () {

    })
  })
}

// Command: wuui page [pageName]
program
  .command('page [pageName]')
  .alias('p')
  .description('创建新的页面')
  .option('--path [moduleName]', '模块名称')
  .option('--name [pageName]', '页面名称')
  .option('--styl', '启用stylus')
  .action(function(pageName, option) {
    let page = new Page({
      pageName: pageName || option.name,
      moduleName: option.path,
      styl: option.styl
    })
    // 创建页面
    page.create(function () {

    })
  }).on('--help', function() {
    console.log('  Examples:');
    console.log('');
    console.log('    $ wuui page name');
    console.log('    $ wuui p name');
    console.log()
  })


program.parse(process.argv)

if(!program.args.length){
  program.help()
}